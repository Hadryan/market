<div class="container-fluid container-main">
    <div bs-active-pane="activeTab" data-nav-class="nav-pills" data-template="processes/processes-tabs-template.html" bs-tabs>
        <div data-title="{{'PROCESSES' | translate}} <span class='badge'>{{Runtime.getEveryActiveProcessesNumber()}}</span>" bs-pane>
            <section id="processes" class="col-md-12">
                <div class="panel panel-default">
                    <div class="panel-heading" translate="PROCESSES"></div>
                    <div ng-if="!Runtime.hasEveryActiveProcesses()" class="panel-body">
                        <p translate="PROCESSES.NO_ACTIVE_PROCCESS"></p>
                    </div>
                    <table ng-if="Runtime.hasEveryActiveProcesses()" class="table table-responsive">
                        <thead>
                        <tr>
                            <th translate="NAME"></th>
                            <th translate="START"></th>
                            <th translate="TYPE"></th>
                            <th translate="PROCESSES.STATE"></th>
                            <th translate="PROCESSES.ACTIVITY"></th>
                            <th translate="ACTIONS"></th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr ng-repeat="process in Runtime.getEveryActiveProcesses() track by process.key">
                            <td>{{::process.name}}</td>
                            <td><span am-time-ago="process.start"></span></td>
                            <td>{{::process.type}}</td>
                            <td>{{('PROCESSES.' + process.state|translate).toUpperCase()}}</td>
                            <td>{{process.activity}}</td>
                            <td ng-switch="process.type">
                                <button ng-switch-when="tool" class="btn btn-sm btn-default" ng-click="showToolParam(process)" translate="TOOLS.VIEW_PARAM"></button>
                                <button class="btn btn-sm btn-default" ng-click="showLog(process)" translate="PROCESSES.VIEW_LOG"></button>
                                <button ng-switch-when="tool" ng-if="Runtime.hasEveryProcessesWithState(Runtime.getStates().pending)" class="btn btn-sm btn-default" ng-click="abortToolJob(process)" translate="TOOLS.ABORT"></button>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </section>
            <section ng-if="Runtime.hasEveryProcessesWithState([Runtime.getStates().aborted ,Runtime.getStates().suspended]) " id="aborted-processus" class="col-md-12">
                <div class="panel panel-default">
                    <div class="panel-heading" translate="PROCESSES.LAST_ABORTED_PROCESSES"></div>
                    <table class="table table-responsive">
                        <thead>
                        <tr>
                            <th translate="NAME"></th>
                            <th translate="START"></th>
                            <th translate="STOP"></th>
                            <th translate="TYPE"></th>
                            <th translate="PROCESSES.STATE"></th>
                            <th translate="ACTIONS"></th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr ng-repeat="process in Runtime.getEveryProcessesWithState([Runtime.getStates().aborted, Runtime.getStates().suspended]) | orderBy: 'start':true" ng-class="{hidden: $index >= abortedProcessessDisplayed}">
                            <td>{{::process.name}}</td>
                            <td><span am-time-ago="process.start"></span></td>
                            <td><span am-time-ago="process.stop"></span></td>
                            <td>{{::process.type}}</td>
                            <td>{{('PROCESSES.' + process.state|translate).toUpperCase()}}</td>
                            <td ng-switch="process.type">
                                <button ng-switch-when="tool" class="btn btn-sm btn-default" ng-click="showResult(process)" translate="PROCESSES.VIEW_RESULT"></button>
                                <button ng-switch-default class="btn btn-sm btn-default" ng-click="showLog(process)" translate="PROCESSES.VIEW_LOG"></button>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </section>
            <section id="completed-processes" class="col-md-12">
                <div class="panel panel-default">
                    <div class="panel-heading" translate="PROCESSES.LAST_COMPLETED_PROCESSES"></div>
                    <div ng-if="!Runtime.hasEveryProcessesWithState(Runtime.getStates().completed)" class="panel-body">
                        <p translate="PROCESSES.NO_COMPLETED_PROCESS"></p>
                    </div>
                    <table ng-if="Runtime.hasEveryProcessesWithState(Runtime.getStates().completed)" class="table table-responsive">
                        <thead>
                        <tr>
                            <th translate="NAME"></th>
                            <th translate="START"></th>
                            <th translate="STOP"></th>
                            <th translate="TYPE"></th>
                            <th translate="ACTIONS"></th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr ng-repeat="process in Runtime.getEveryProcessesWithState(Runtime.getStates().completed) | orderBy: 'start':true" ng-class="{hidden: $index >= completedProcessessDisplayed}">
                            <td>{{::process.name}}</td>
                            <td><span am-time-ago="process.start"></span></td>
                            <td><span am-time-ago="process.stop"></span></td>
                            <td>{{::process.type}}</td>
                            <td ng-switch="process.type">
                                <button ng-switch-when="tool" class="btn btn-sm btn-default" ng-click="showResult(process)" translate="PROCESSES.VIEW_RESULT"></button>
                                <button ng-switch-default class="btn btn-sm btn-default" ng-click="showLog(process)" translate="PROCESSES.VIEW_LOG"></button>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                    <!--<div class="panel-footer toggle-show-all" ng-if="(Runtime.getProcessesWithState(Runtime.getStates().completed).length + Runtime.getRemoteProcessesWithState(Runtime.getStates().completed).length) > completedProcessessDisplayed" ng-click="showAll($event)" translate="PROCESSES.SHOW_ALL"></div>-->
                </div>
            </section>
        </div>
        <div data-title="{{'PROCESSES.PROCESSES_HISTORY' | translate}}" bs-pane>
            <section id="history" class="col-md-12">
                <div ng-if="!Runtime.hasEveryProcessesWithState([Runtime.getStates().completed, Runtime.getStates().aborted, Runtime.getStates().suspended])" class="panel-body">
                    <p translate="PROCESSES.NO_COMPLETED_PROCESS"></p>
                </div>
                <table ng-if="Runtime.hasEveryProcessesWithState([Runtime.getStates().completed, Runtime.getStates().aborted, Runtime.getStates().suspended])"
                       class="table table-hover table-responsive table-condensed history">
                    <thead class="small">
                    <tr>
                        <th ng-click="order('name', 'toggle')">
                            <span translate="NAME"></span>
                            <span order-indicator data-name="name" data-order-prop="orderProp" data-order-reverse="orderReverse" ></span>
                        </th>
                        <th ng-click="order('start', 'toggle')">
                            <span translate="START"></span>
                            <span order-indicator data-name="start" data-order-prop="orderProp" data-order-reverse="orderReverse"></span>
                        </th>
                        <th ng-click="order('stop', 'toggle')">
                            <span translate="STOP"></span>
                            <span order-indicator data-name="stop" data-order-prop="orderProp" data-order-reverse="orderReverse"></span>
                        </th>
                        <th translate="TYPE"></th>
                        <th translate="STATUS"></th>
                        <th translate="ACTIONS"></th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr ng-repeat="process in filteredOrderedProcesses(Runtime.getEveryProcessesWithState([Runtime.getStates().completed, Runtime.getStates().aborted, Runtime.getStates().suspended])) track by process.key"
                        ng-class="{hidden: $index >= processessDisplayed}">
                        <td>{{::process.name}}</td>
                        <td>{{process.start | date:'medium'}}</td>
                        <td>{{process.stop | date:'medium'}}</td>
                        <td>{{::process.type}}</td>
                        <td style="{{process.state === Runtime.getStates().aborted ? 'color:red': process.state === Runtime.getStates().suspended ? 'color:#E25D17': ''}}">{{('PROCESSES.' + process.state|translate).toUpperCase()}}</td>
                        <td ng-switch="process.type">
                            <button ng-switch-when="tool" class="btn btn-sm btn-default" ng-click="showResult(process)" translate="PROCESSES.VIEW_RESULT"></button>
                            <button ng-switch-default class="btn btn-sm btn-default" ng-click="showLog(process)" translate="PROCESSES.VIEW_LOG"></button>
                        </td>
                    </tr>
                    </tbody>
                </table>
                <div class="btn-primary toggle-show-all" ng-if="Runtime.getEveryProcessesNumberWithState([Runtime.getStates().completed, Runtime.getStates().aborted, Runtime.getStates().suspended]) > processessDisplayed" ng-click="showAll($event)" translate="PROCESSES.SHOW_ALL"></div>
            </section>
        </div>

    </div>
    <div ng-include="'common/tools/tool-result.html'" ng-controller="ToolResultsCtrl"></div>

</div>
