<section class="market-item" ng-controller="OrtolangItemJson13Ctrl">
    <header>
        <div class="media">
            <div class="media-left">
                <div class="item-logo">
                    <img ng-if="imgtitle !== undefined" class="image loaded-image" ng-src="" holder-js="holder.js/180x180?theme={{imgtheme}}&text={{imgtitle}}&size=63"  alt="{{'MARKET.THUMBNAIL' | translate}}"/>
                    <img ng-show="image" ng-src="{{image}}" class="image loaded-image" alt="{{'MARKET.THUMBNAIL' | translate}}"/>
                </div>
            </div>
            <div class="media-body">
                <h1 class="market-item-title" ng-class="root === 'head' ? 'text-danger' : ''">
                    <span ng-if="root === 'head'" translate="MARKET.PREVIEW_OF"></span>
                    <span ng-bind="title"></span>
                </h1>

                <div ng-hide="browse">

                    <div ng-if="producers" class="market-item-producers"><i translate="MARKET.PRODUCER" data-translate-values="{publicationDate: content.publicationDate}"></i> :
                        <ul class="list-unstyled">
                            <li ng-repeat="producer in producers track by producer.id">
                                <a ng-href='/producers/{{producer.id}}' ng-bind="producer.fullname"></a>
                            </li>
                        </ul>
                    </div>
                    <div ng-if="sponsors" class="market-item-producers"><i>{{'MARKET.SPONSORS' | translate}}</i> :
                        <ul class="list-unstyled">
                            <li class="sponsor" ng-repeat="sponsor in sponsors">
                                {{sponsor.fullname}} <a target="_BLANK" ng-if="sponsor.homepage" ng-href="{{sponsor.homepage}}"><span class="fa fa-fw fa-external-link"></span></a>
                            </li>
                        </ul>
                    </div>
                    <div ng-if="tags.length > 1"><span translate="MARKET.ALL_VERSIONS"></span> :
                        <ul class="list-inline all-versions">
                            <li ng-repeat="t in ::tags">
                                <div class="label tag" ng-class="::tag.name === t.name ? 'label-primary' : ''">
                                    <span ng-class="::icons.tag"></span>
                                    <a ng-if="::tag.name !== t.name" ng-href="/market/{{::itemMarketType}}/{{::alias}}/{{::t.name}}" translate="BROWSER.VERSION" data-translate-values="{tag: t.name}"></a>
                                    <span ng-if="::tag.name === t.name" translate="BROWSER.VERSION" data-translate-values="{tag: t.name}"></span>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
                <button class="btn btn-default" ng-show="browse" ng-click="browseContent()" translate="MARKET.GO_BACK_INFO"></button>
            </div>
        </div>
    </header>

    <div class="row">

        <div ng-if="browse" class="col-md-12">
            <div browser></div>
        </div>

        <div ng-show="!browse" class="col-md-8 market-item-presentation-metadata">
            <section id="description">
                <h4>{{'DESCRIPTION' | translate}}</h4>
                <article data-content="description" data-target-blank>
                    <div ng-bind-html="description"></div>
                    <br/>
                    <div ng-if="keywords && keywords.length>0">
                        <dl class="keywords">
                            <dt data-translate="MARKET.KEYWORDS"> : </dt>
                            <dd>
                                <span ng-repeat="keyword in keywords"><span ng-if="!$first">, </span>{{keyword}}</span>
                            </dd>
                        </dl>
                        <br/>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div ng-if="documentations && documentations.length>1" class="btn-group">
                                <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                                    {{'MARKET.SEE_DOCUMENTATIONS' | translate}} <span class="caret"></span>
                                </button>
                                <ul class="dropdown-menu dropdown-menu-left" role="menu">
                                    <li ng-repeat="relation in documentations">
                                        <a target="_BLANK" ng-href="{{relation.url}}">
                                            {{relation.name}}
                                        </a>
                                    </li>
                                </ul>
                            </div>
                            <div ng-if="documentations && documentations.length===1">
                                <a target="_BLANK" class="btn btn-default" ng-href="{{documentations[0].url}}">
                                    <span class="fa fa-fw fa-info-circle"></span> {{'MARKET.SEE_DOCUMENTATIONS' | translate}}
                                </a>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="pull-right" ng-if="content.website">
                                <a target="_BLANK" class="btn btn-primary" ng-href="{{content.website}}">
                                    <span class="fa fa-fw fa-external-link"></span> {{'MARKET.SEE_WEBSITE' | translate}}
                                </a>
                            </div>
                        </div>
                    </div>
                </article>
            </section>

            <section class="contributors" ng-if="contributors">
                <h4>{{'MARKET.CONTRIBUTOR' | translate}}</h4>

                <article>
                    <div class="row auto-clear">
                        <div ng-repeat="contributor in contributors" ng-click="seeContributorPage(contributor)"
                             class="media profile-card contributor-card col-md-6 col-lg-4"
                             ng-class="{'contributor-link': contributor.entity.id}">
                            <div class="media-left" avatar data-email-hash="contributor.entity.emailhash" data-size="60" data-img-classes="img-rounded">
                            </div>
                            <div class="media-body">
                                <span class="name">{{contributor.entity.fullname}} <span ng-if="contributor.organization.acronym">({{contributor.organization.acronym}})</span></span>
                                <div class="small roles">
                                    <span ng-repeat="role in contributor.roles">{{role}}<span ng-if="!$last">, </span></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </article>
            </section>

            <section class="keywords" ng-if="additionalInformations.length>0">
                <h4>{{'MARKET.ADDITIONAL_INFORMATION' | translate}}</h4>
                <article>
                    <div class="row">
                        <div ng-repeat="additionalInformation in additionalInformations" class="col-md-3">
                            <dl ng-if="!isArray(additionalInformation.value)">
                                <dt translate="{{additionalInformation.name}}"></dt>
                                <dd>
                                    {{additionalInformation.value}}
                                </dd>
                            </dl>
                            <dl ng-if="isArray(additionalInformation.value)">
                                <dt translate="{{additionalInformation.name}}"></dt>
                                <dd ng-repeat="valueItem in additionalInformation.value">
                                    {{valueItem}}
                                </dd>
                            </dl>
                        </div>
                    </div>
                </article>
            </section>

            <section id="publications" ng-if="content.publications.length>0">
                <h4>{{'MARKET.PUBLICATIONS' | translate}}</h4>
                <div class="section-body-wrapper">
                    <dl>
                        <dt translate="MARKET.PRIMARY_PUBLICATIONS"></dt>
                        <dd ng-repeat="pub in content.publications" ng-bind-html="pub">
                        </dd>
                    </dl>
                </div>
            </section>
        </div>

        <aside ng-show="!browse" class="col-md-4">

        <div class="panel panel-default" ng-show="commercialLinks">
                <div class="panel-heading"> {{'MARKET.COMMERCIAL_LINKS' | translate}}</div>
                <div class="panel-body">

                    <div class="media" ng-repeat="commercialLink in commercialLinks">
                        <div class="media-left">
                            <img ng-src="{{commercialLink.img}}">
                        </div>
                        <div class="media-body">
                            <p>
                                {{commercialLink.description}}<a target="_BLANK" ng-href="{{commercialLink.url}}"><span class="fa fa-fw fa-external-link"></span></a>
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="panel panel-default license-panel" ng-show="content.type !== 'Application'">
                <div class="panel-heading"><span class="fa fa-download fa-fw"></span> {{'MARKET.DOWNLOAD' | translate}}</div>
                <div class="panel-body">
                    <dl ng-if="license">
                        <dt>
                            {{license.label}} <a target="_BLANK" ng-if="(!license.description || conditionsOfUse) && license.effectiveText && license.effectiveText.url" ng-href="{{license.effectiveText.url}}"><span class="fa fa-fw fa-external-link"></span></a>
                        </dt>
                        <dd ng-show="!conditionsOfUse && license.description">
                            <span ng-if="license.effectiveDescription">{{license.effectiveDescription}}</span><a target="_BLANK" ng-if="license.effectiveText && license.effectiveText.url" ng-href="{{license.effectiveText.url}}"><span class="fa fa-fw fa-external-link"></span></a>
                        </dd>
                        <dd ng-show="conditionsOfUse">
                            <span ng-bind-html="conditionsOfUse"></span>
                        </dd>
                    </dl>
                    <p ng-if="!license && conditionsOfUse" ng-bind-html="conditionsOfUse"></p>
                    <!-- <p data-visualizer ng-show="licenseDataObject"><a id="preview-license" ng-click="showPreview(licenseDataObject.key)" translate="MARKET.LICENCE_DETAIL"></a></p> -->
                    <div class="btn-group btn-group-justified" role="group" ng-show="datasizeToPrint">
                        <div class="btn-group" role="group">
                            <button class="btn btn-success" data-ng-disabled="root === 'head'" ng-click="exportItem()" translate="DOWNLOAD" data-title="{{'MARKET.DOWNLOAD_ALL' | translate:datasizeToPrint}}" data-placement="bottom" bs-tooltip></button>
                        </div>
                        <div class="btn-group" role="group">
                            <button class="btn btn-default" data-ng-disabled="root === 'head'" ng-click="browseContent()" translate="MARKET.BROWSE"></button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="panel panel-default" ng-show="content.type === 'Application'">
                <div class="panel-heading"><span class="fa fa-link fa-fw"></span> {{'MARKET.LINK' | translate}}</div>
                <div class="panel-body">

                    <div class="btn-group btn-group-justified">
                        <a ng-href="{{content.applicationUrl}}" target="_BLANK" class="btn btn-block btn-success" translate="MARKET.SITE"></a>
                    </div>
                </div>
            </div>

            <div class="panel panel-default derogation-panel" ng-show="content.derogation">
                <div class="panel-heading" translate="MARKET.DEROGATION"></div>
                <div class="panel-body">

                    <p>
                        <a href="http://www.archivesdefrance.culture.gouv.fr/seda/api/seda_v1-0_accessrestriction_code_xsd_Simple_Type_AccessRestrictionCodeType.htm#AccessRestrictionCodeType" target="_BLANK">{{content.derogation}}</a>
                        <span ng-if="content.derogation==='AR038'"> - Documents librement communicables. (Code du Patrimoine, art. L. 211-1, L. 211-4, L. 213-1)</span>
                        <span ng-if="content.derogation==='AR048'"> - Documents dont la communication porte atteinte à la protection de la vie privée ou portant appréciation ou jugement de valeur sur une personne physique nommément désignée, ou facilement identifiable, ou qui font apparaître le comportement d'une personne dans des conditions susceptibles de lui porter préjudice. (Code du Patrimoine, art. L. 213-2, I, 3)</span>
                        <span ng-if="content.derogation==='AR042'"> - Documents élaborés dans le cadre d'un contrat de prestation de services exécuté pour le compte d'une ou de plusieurs personnes déterminées. (Code du Patrimoine, art. L. 213-2, I, 1, b)</span>
                    </p>

                </div>
            </div>

            <div class="panel panel-default" ng-show="bibliographicCitation">
                <div class="panel-heading" translate="MARKET.BIBLIOGRAPHIC_CITATION"></div>
                <div data-target-blank data-content="bibliographicCitation" class="panel-body">
                    <p ng-bind-html="bibliographicCitation"></p>
                </div>
            </div>

            <div class="panel panel-default" ng-hide="bibliographicCitation">
                <div class="panel-heading" translate="MARKET.BIBLIOGRAPHIC_CITATION"></div>
                <div data-target-blank data-content="bibliographicCitation" class="panel-body">
                    <p ng-if="content.publications && content.publications.length>0" ng-bind-html="content.publications[0]">
                    </p>
                    <p>
                        <span ng-repeat="producer in producers" ng-if="producers">
                            <span ng-if="!$first">, </span>{{producer.fullname}}
                        </span>
                        <span ng-repeat="author in authors" ng-if="!producers">
                            <span ng-if="!$first">, </span>{{author.entity.fullname}}
                        </span>.
                        ({{content.publicationDate | date:'yyyy'}}).
                        <i>{{title}}</i> [{{content.type}}].
                        Disponible sur <a target="_BLANK" href="http://www.ortolang.fr">www.ortolang.fr</a> :
                        <a target="_BLANK" ng-href="{{handle}}">{{handle}}</a>
                    </p>
                </div>
            </div>

            <div class="panel panel-default preview-box-list-wrapper" ng-if="content.preview && content.preview.length>0">
                <div class="panel-heading"><span class="glyphicon glyphicon-eye-open fa-fw"></span> {{'MARKET.PREVIEW' | translate}}</div>
                <div class="panel-body">
                    <div ng-show="itemKey" preview-list collection="itemKey" paths="content.preview"></div>
                </div>
            </div>

            <div class="panel panel-default" ng-if="content.copyright">
                <div class="panel-heading">{{'MARKET.COPYRIGHT' | translate}}</div>
                <div class="panel-body">
                    <p ng-bind="content.copyright"></p>
                </div>
            </div>
        </aside>

    </div>
</section>
